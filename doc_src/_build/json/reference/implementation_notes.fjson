{"body": "<div class=\"section\" id=\"implementation-notes\">\n<h1>Implementation Notes<a class=\"headerlink\" href=\"#implementation-notes\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<ol class=\"arabic simple\">\n<li>There could be potentially a large number of variations for an individual field.</li>\n<li>We want to keep the number of database calls/accesses and data storage to a minimum.</li>\n<li>We must track some metadata about the variations, such as: variations used, invalidated variations.</li>\n</ol>\n<div class=\"section\" id=\"methods\">\n<h2>Methods<a class=\"headerlink\" href=\"#methods\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<ol class=\"arabic\">\n<li><dl class=\"first docutils\">\n<dt>Related table(s)</dt>\n<dd><p class=\"first\">There are several variations:</p>\n<ul class=\"last simple\">\n<li>One table for each model with variations (using a Foreign Key)</li>\n<li>One table for all models with variations (using a Generic Foreign Key)</li>\n<li>Use a JSON field for all text variations of an object</li>\n<li>A separate row for each text variation</li>\n</ul>\n</dd>\n</dl>\n</li>\n<li><dl class=\"first docutils\">\n<dt>Additional field(s) in the model</dt>\n<dd><p class=\"first\">There are two variations:</p>\n<ul class=\"last simple\">\n<li>Use a JSON field for all text variations of an object</li>\n<li>A separate field for each potential text variation</li>\n</ul>\n</dd>\n</dl>\n</li>\n</ol>\n</div>\n<div class=\"section\" id=\"implementation\">\n<h2>Implementation<a class=\"headerlink\" href=\"#implementation\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>A combination of both methods will be used in a non-normalized way to provide flexibility and performance. A variation table for each model with variations will store each variation for each field. A JSON/serialized field on the model will store a cached version of the same information.</p>\n<p>The fields in the variation table are:</p>\n<table border=\"1\" class=\"docutils\">\n<colgroup>\n<col width=\"4%\" />\n<col width=\"96%\" />\n</colgroup>\n<thead valign=\"bottom\">\n<tr><th class=\"head\">field</th>\n<th class=\"head\">Description</th>\n</tr>\n</thead>\n<tbody valign=\"top\">\n<tr><td>&lt;model&gt;_id</td>\n<td>Foreign key to the row in the master table</td>\n</tr>\n<tr><td>fieldname</td>\n<td>Name of the field in which this variation applies</td>\n</tr>\n<tr><td>&lt;name&gt;_dim</td>\n<td>A field for each defined dimension to contain the dimension variant</td>\n</tr>\n<tr><td>is_invalid</td>\n<td>A boolean flag to indicate the variation is currently invalid, as the default variation has changed. Declaring variations invalid instead of deleting them should be an option as to allow the site to continue to display the content.</td>\n</tr>\n<tr><td>value</td>\n<td>The value of this variation for this field</td>\n</tr>\n</tbody>\n</table>\n<p>The cache field contains a structure based on the current <a class=\"reference internal\" href=\"../settings/#settings-dimension-priority\"><em>DIMENSION_PRIORITY</em></a> settings.</p>\n<div class=\"admonition warning\">\n<p class=\"first admonition-title\">Warning</p>\n<p class=\"last\">If this setting changes the cache field for each item in every table will need to be recalculated. There is a management command to do this.</p>\n</div>\n<p>The cache is a hierarchical dictionary with each field at the top level and then each dimension hierarchically contained in order of priority.</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"p\">{</span>\n    <span class=\"s\">&#39;field&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s\">&#39;dim1-variant1&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"s\">&#39;dim2-variant1&#39;</span><span class=\"p\">:</span> <span class=\"s\">&#39;variation value&#39;</span><span class=\"p\">,</span>\n            <span class=\"s\">&#39;dim2-variant2&#39;</span><span class=\"p\">:</span> <span class=\"s\">&#39;variation value&#39;</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</pre></div>\n</div>\n</div>\n<div class=\"section\" id=\"example-walkthrough\">\n<h2>Example Walkthrough<a class=\"headerlink\" href=\"#example-walkthrough\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Assuming that we have three dimensions: audience, text difficulty, and language; a table called article with three variable fields: headline, subhead, and content; the table and metadata table might look like:</p>\n<div class=\"admonition note\">\n<p class=\"first admonition-title\">Note</p>\n<p class=\"last\">See <a class=\"reference internal\" href=\"../settings/#settings-example\"><em>Example Settings</em></a> for the configuration.</p>\n</div>\n<img alt=\"../../_images/variations-schema-example.png\" src=\"../../_images/variations-schema-example.png\" />\n<p>If you added a row into article, you might have</p>\n<table border=\"1\" class=\"docutils\">\n<colgroup>\n<col width=\"3%\" />\n<col width=\"18%\" />\n<col width=\"12%\" />\n<col width=\"11%\" />\n<col width=\"15%\" />\n<col width=\"41%\" />\n</colgroup>\n<thead valign=\"bottom\">\n<tr><th class=\"head\">Id</th>\n<th class=\"head\">Headline</th>\n<th class=\"head\">Subhead</th>\n<th class=\"head\">Byline</th>\n<th class=\"head\">Content</th>\n<th class=\"head\">Text Variations</th>\n</tr>\n</thead>\n<tbody valign=\"top\">\n<tr><td>1</td>\n<td>First article</td>\n<td>&nbsp;</td>\n<td>Carmen</td>\n<td>Lots of ...</td>\n<td><tt class=\"docutils literal\"><span class=\"pre\">{'headline':{'en':{'ad'...</span></tt></td>\n</tr>\n</tbody>\n</table>\n<p>The Text Variations field would contain a serialized dictionary:</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"p\">{</span>\n    <span class=\"s\">&#39;headline&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s\">&#39;en&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;ad&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;s&#39;</span><span class=\"p\">:</span> <span class=\"s\">&#39;First Article&#39;</span><span class=\"p\">,},},},</span>\n    <span class=\"s\">&#39;subhead&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s\">&#39;en&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;ad&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;s&#39;</span><span class=\"p\">:</span> <span class=\"s\">&#39;&#39;</span><span class=\"p\">,},},},</span>\n    <span class=\"s\">&#39;content&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s\">&#39;en&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;ad&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;s&#39;</span><span class=\"p\">:</span> <span class=\"s\">&#39;Lots of ...&#39;</span><span class=\"p\">,},},},</span>\n<span class=\"p\">}</span>\n</pre></div>\n</div>\n<p>And the Audience Variation table contains</p>\n<table border=\"1\" class=\"docutils\">\n<colgroup>\n<col width=\"3%\" />\n<col width=\"11%\" />\n<col width=\"10%\" />\n<col width=\"13%\" />\n<col width=\"13%\" />\n<col width=\"20%\" />\n<col width=\"11%\" />\n<col width=\"20%\" />\n</colgroup>\n<thead valign=\"bottom\">\n<tr><th class=\"head\">Id</th>\n<th class=\"head\">Article Id</th>\n<th class=\"head\">Fieldname</th>\n<th class=\"head\">Audience Dim</th>\n<th class=\"head\">Language Dim</th>\n<th class=\"head\">Text Difficulty Dim</th>\n<th class=\"head\">Is Invalid</th>\n<th class=\"head\">Value</th>\n</tr>\n</thead>\n<tbody valign=\"top\">\n<tr><td>1</td>\n<td>1</td>\n<td>headline</td>\n<td>ad</td>\n<td>en</td>\n<td>s</td>\n<td>False</td>\n<td>First Article</td>\n</tr>\n<tr><td>2</td>\n<td>1</td>\n<td>subhead</td>\n<td>ad</td>\n<td>en</td>\n<td>s</td>\n<td>False</td>\n<td>&nbsp;</td>\n</tr>\n<tr><td>3</td>\n<td>1</td>\n<td>content</td>\n<td>ad</td>\n<td>en</td>\n<td>s</td>\n<td>False</td>\n<td>Lots of ...</td>\n</tr>\n</tbody>\n</table>\n<p>If you add a spanish variation to the headline and content fields, the Text Variations field would contain:</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"p\">{</span>\n    <span class=\"s\">&#39;headline&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s\">&#39;en&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;ad&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;s&#39;</span><span class=\"p\">:</span> <span class=\"s\">&#39;First Article&#39;</span><span class=\"p\">,},},</span>\n        <span class=\"s\">&#39;es&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;ad&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;s&#39;</span><span class=\"p\">:</span> <span class=\"s\">u&#39;Art\u00edculo Primero&#39;</span><span class=\"p\">,},},},</span>\n    <span class=\"s\">&#39;subhead&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s\">&#39;en&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;ad&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;s&#39;</span><span class=\"p\">:</span> <span class=\"s\">&#39;&#39;</span><span class=\"p\">,},},},</span>\n    <span class=\"s\">&#39;content&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s\">&#39;en&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;ad&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;s&#39;</span><span class=\"p\">:</span> <span class=\"s\">&#39;Lots of ...&#39;</span><span class=\"p\">,},},</span>\n        <span class=\"s\">&#39;es&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;ad&#39;</span><span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"s\">&#39;s&#39;</span><span class=\"p\">:</span> <span class=\"s\">&#39;Mucho ...&#39;</span><span class=\"p\">,},},},</span>\n<span class=\"p\">}</span>\n</pre></div>\n</div>\n<p>And the Audience Variation table contains</p>\n<table border=\"1\" class=\"docutils\">\n<colgroup>\n<col width=\"3%\" />\n<col width=\"11%\" />\n<col width=\"10%\" />\n<col width=\"13%\" />\n<col width=\"13%\" />\n<col width=\"20%\" />\n<col width=\"11%\" />\n<col width=\"20%\" />\n</colgroup>\n<thead valign=\"bottom\">\n<tr><th class=\"head\">Id</th>\n<th class=\"head\">Article Id</th>\n<th class=\"head\">Fieldname</th>\n<th class=\"head\">Audience Dim</th>\n<th class=\"head\">Language Dim</th>\n<th class=\"head\">Text Difficulty Dim</th>\n<th class=\"head\">Is Invalid</th>\n<th class=\"head\">Value</th>\n</tr>\n</thead>\n<tbody valign=\"top\">\n<tr><td>1</td>\n<td>1</td>\n<td>headline</td>\n<td>ad</td>\n<td>en</td>\n<td>s</td>\n<td>False</td>\n<td>First Article</td>\n</tr>\n<tr><td>2</td>\n<td>1</td>\n<td>subhead</td>\n<td>ad</td>\n<td>en</td>\n<td>s</td>\n<td>False</td>\n<td>&nbsp;</td>\n</tr>\n<tr><td>3</td>\n<td>1</td>\n<td>content</td>\n<td>ad</td>\n<td>en</td>\n<td>s</td>\n<td>False</td>\n<td>Lots of ...</td>\n</tr>\n<tr><td>4</td>\n<td>1</td>\n<td>headline</td>\n<td>ad</td>\n<td>es</td>\n<td>s</td>\n<td>False</td>\n<td>Art\u00edculo Primero</td>\n</tr>\n<tr><td>5</td>\n<td>1</td>\n<td>content</td>\n<td>ad</td>\n<td>es</td>\n<td>s</td>\n<td>False</td>\n<td>Mucho ...</td>\n</tr>\n</tbody>\n</table>\n</div>\n<div class=\"section\" id=\"schema-migrations\">\n<h2>Schema Migrations<a class=\"headerlink\" href=\"#schema-migrations\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Adding/removing the JSON field</p>\n<p>Adding/removing a metadata dimension field</p>\n</div>\n</div>\n", "display_toc": true, "title": "Implementation Notes", "sourcename": "reference/implementation_notes.txt", "customsidebar": null, "current_page_name": "reference/implementation_notes", "next": {"link": "../management_commands/", "title": "Management Commands"}, "rellinks": [["genindex", "General Index", "I", "index"], ["reference/management_commands", "Management Commands", "N", "next"], ["reference/settings", "Settings", "P", "previous"]], "meta": {}, "parents": [{"link": "../", "title": "Reference"}], "sidebars": null, "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Implementation Notes</a><ul>\n<li><a class=\"reference internal\" href=\"#methods\">Methods</a></li>\n<li><a class=\"reference internal\" href=\"#implementation\">Implementation</a></li>\n<li><a class=\"reference internal\" href=\"#example-walkthrough\">Example Walkthrough</a></li>\n<li><a class=\"reference internal\" href=\"#schema-migrations\">Schema Migrations</a></li>\n</ul>\n</li>\n</ul>\n", "prev": {"link": "../settings/", "title": "Settings"}, "metatags": ""}